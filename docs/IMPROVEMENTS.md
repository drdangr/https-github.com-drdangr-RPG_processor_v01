# –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç —Å–ø–∏—Å–æ–∫ —É–ª—É—á—à–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ —Å—Ç–æ–∏—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–≤—ã—à–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã –°–∏–º—É–ª—è—Ü–∏—è + –ù–∞—Ä—Ä–∞—Ç–∏–≤.

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ

### 1. –Ø–∑—ã–∫ thinking

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ú–æ–¥–µ–ª—å —Ä–∞–∑–º—ã—à–ª—è–ª–∞ –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–æ–º —è–∑—ã–∫–µ
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è `–Ø–ó–´–ö: –î—É–º–∞–π –∏ –æ—Ç–≤–µ—á–∞–π –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ` –≤ –æ–±–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ø—Ä–æ–º–ø—Ç–∞

### 2. –í–∞–ª–∏–¥–∞—Ü–∏—è –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –ø–µ—Ä–µ–¥ –≤—ã–∑–æ–≤–æ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –≤–∞–ª–∏–¥–∞—Ü–∏—è `required` –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –≤ `geminiService.ts`

### 3. –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ tool calls

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ö–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –¥—É–±–ª–∏—Ä–æ–≤–∞–ª—Å—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö (–æ—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Å—Ç–∞–≤—à–∏—Ö—Å—è tool calls)
- **–†–µ—à–µ–Ω–∏–µ**: –í—ã–Ω–µ—Å–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `executeToolCalls` –≤ `services/geminiService.ts`, –∫–æ—Ç–æ—Ä–∞—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑—É–µ—Ç –ª–æ–≥–∏–∫—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –∏ —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞

### 6. –ë–æ–ª—å—à–æ–π JSON —Å–æ—Å—Ç–æ—è–Ω–∏—è –≤ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ

- **–ü—Ä–æ–±–ª–µ–º–∞**: –í–µ—Å—å `GameState` —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–ª—Å—è –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å, —á—Ç–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–≤–µ–ª–∏—á–∏–≤–∞–ª–æ —Ä–∞—Å—Ö–æ–¥ —Ç–æ–∫–µ–Ω–æ–≤ –ø—Ä–∏ –∫–∞–∂–¥–æ–º —à–∞–≥–µ –º–Ω–æ–≥–æ—Ö–æ–¥–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
- **–†–µ—à–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `getRelevantState`, –∫–æ—Ç–æ—Ä–∞—è –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:
  - –¢–µ–∫—É—â–∞—è –ª–æ–∫–∞—Ü–∏—è –∏–≥—Ä–æ–∫–∞ (—Å –ø–æ–ª–Ω—ã–º –æ–ø–∏—Å–∞–Ω–∏–µ–º)
  - –°–æ—Å–µ–¥–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏ (—Ç–æ–ª—å–∫–æ ID, name –∏ connections, –±–µ–∑ –æ–ø–∏—Å–∞–Ω–∏–π)
  - –û–±—ä–µ–∫—Ç—ã –≤ —Ç–µ–∫—É—â–µ–π –ª–æ–∫–∞—Ü–∏–∏ –∏ —É –∏–≥—Ä–æ–∫–∞
  - –û–±—ä–µ–∫—Ç—ã –≤ —Å–æ—Å–µ–¥–Ω–∏—Ö –ª–æ–∫–∞—Ü–∏—è—Ö –∏ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
  - –î–ª—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –Ω–∞—Ä—Ä–∞—Ç–∏–≤–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–æ–ª–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–Ω—É–∂–Ω–æ –¥–ª—è —Ä–∞–∑–º–µ—Ç–∫–∏ –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤)
- **–≠—Ñ—Ñ–µ–∫—Ç**: –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ–µ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ä–∞—Å—Ö–æ–¥–∞ —Ç–æ–∫–µ–Ω–æ–≤ –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ —Å–∏–º—É–ª—è—Ü–∏–∏ (—ç–∫–æ–Ω–æ–º–∏—è –º–æ–∂–µ—Ç –¥–æ—Å—Ç–∏–≥–∞—Ç—å 50-70% –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–∑–º–µ—Ä–∞ –º–∏—Ä–∞)

### 13. –£–ª—É—á—à–µ–Ω–∏–µ UX –≤—ã–±–æ—Ä–∞ —Å–≤—è–∑–µ–π (Hierarchy Chips)

- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–ª–æ–∂–Ω–æ –≤—ã–±–∏—Ä–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π –æ–±—ä–µ–∫—Ç –≤ –≤—ã–ø–∞–¥–∞—é—â–µ–º —Å–ø–∏—Å–∫–µ.
- **–†–µ—à–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `HierarchySelect`, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏–π –ø—É—Ç—å –∫ –æ–±—ä–µ–∫—Ç—É –≤ –≤–∏–¥–µ —Ü–µ–ø–æ—á–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã—Ö "—á–∏–ø—Å–æ–≤" (Breadcrumbs).

### 14. Drag and Drop –¥–ª—è –æ–±—ä–µ–∫—Ç–æ–≤

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–µ—É–¥–æ–±–Ω–æ –ø–µ—Ä–µ–º–µ—â–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞–º–∏ —á–µ—Ä–µ–∑ –≤—ã–ø–∞–¥–∞—é—â–∏–µ —Å–ø–∏—Å–∫–∏.
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Drag and Drop –≤ —Å–ø–∏—Å–∫–µ –æ–±—ä–µ–∫—Ç–æ–≤. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏–µ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞–º–∏ –∏ –∑–∞—â–∏—Ç–∞ –æ—Ç —Ü–∏–∫–ª–∏—á–µ—Å–∫–∏—Ö —Å—Å—ã–ª–æ–∫.

### 12. Unit-—Ç–µ—Å—Ç—ã –¥–ª—è geminiService

- **–ü—Ä–æ–±–ª–µ–º–∞**: –û—Ç—Å—É—Ç—Å—Ç–≤–æ–≤–∞–ª–∏ —Ç–µ—Å—Ç—ã –Ω–∞ –∫–ª—é—á–µ–≤—É—é –ª–æ–≥–∏–∫—É —Å–∏–º—É–ª—è—Ü–∏–∏.
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω—ã comprehensive —Ç–µ—Å—Ç—ã –≤ `services/__tests__/geminiService.test.ts` (–ø–æ–∫—Ä—ã—Ç–∏–µ: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ç–µ–∫—Å—Ç–∞, —Ç—É–ª-–∫–æ–ª–ª—ã, —Ü–∏–∫–ª—ã, –æ—à–∏–±–∫–∏).

### 15. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Å—ã–ª–æ–∫ –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ ($N.createdId)

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ü–µ–ø–æ—á–µ–∫ –¥–µ–π—Å—Ç–≤–∏–π (—Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç -> –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –µ–≥–æ) –≤—Ç–æ—Ä–æ–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –Ω–µ –∑–Ω–∞–ª ID —Ç–æ–ª—å–∫–æ —á—Ç–æ —Å–æ–∑–¥–∞–Ω–Ω–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞.
- **–†–µ—à–µ–Ω–∏–µ**: –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–µ–∑–æ–ª–≤–∏–Ω–≥–∞ —Å—Å—ã–ª–æ–∫ `resolveReferences` –≤ `geminiService.ts`. –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `$0.createdId`, `$1.createdId` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –≤ —Ç–æ–π –∂–µ –∏—Ç–µ—Ä–∞—Ü–∏–∏.

### 16. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ Thinking Models

- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–ª–æ–∂–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Å–∏–º—É–ª—è—Ü–∏–∏ —Ç—Ä–µ–±–æ–≤–∞–ª–∞ —Ä–∞—Å—Å—É–∂–¥–µ–Ω–∏–π –º–æ–¥–µ–ª–∏ –ø–µ—Ä–µ–¥ –¥–µ–π—Å—Ç–≤–∏–µ–º.
- **–†–µ—à–µ–Ω–∏–µ**: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ `thinkingConfig` –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ `thought` —á–∞—Å—Ç–µ–π –∏–∑ –æ—Ç–≤–µ—Ç–∞ –º–æ–¥–µ–ª–∏ (–¥–ª—è –º–æ–¥–µ–ª–µ–π —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π thinking, –Ω–∞–ø—Ä–∏–º–µ—Ä `gemini-2.0-flash-thinking`).

### 10. –í—ã–Ω–µ—Å—Ç–∏ –ø—Ä–æ–º–ø—Ç—ã –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–∞–π–ª

- **–ü—Ä–æ–±–ª–µ–º–∞**: –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –±—ã–ª–∏ –∑–∞—à–∏—Ç—ã –≤ `services/geminiService.ts`, —á—Ç–æ —É—Å–ª–æ–∂–Ω—è–ª–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.
- **–†–µ—à–µ–Ω–∏–µ**: –ü—Ä–æ–º–ø—Ç—ã –≤—ã–Ω–µ—Å–µ–Ω—ã –≤ `prompts/systemPrompts.ts` –∏ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –≤ —Å–µ—Ä–≤–∏—Å.

### 4. –ù–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ª–æ–∫–∞—Ü–∏–∏ –∏–≥—Ä–æ–∫–∞ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –Ω–∞—Ä—Ä–∞—Ç–∏–≤–∞

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–∞—Ä—Ä–∞—Ç–∏–≤ –ø–æ–ª—É—á–∞–ª —Ç–æ–ª—å–∫–æ `userPrompt`, –Ω–æ –Ω–µ –∑–Ω–∞–ª, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –∏–≥—Ä–æ–∫ (–∞—Ç–º–æ—Å—Ñ–µ—Ä–∞, –æ–ø–∏—Å–∞–Ω–∏–µ –ª–æ–∫–∞—Ü–∏–∏).
- **–†–µ—à–µ–Ω–∏–µ**: –í `createSystemInstruction` –¥–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω–∞—Ö–æ–¥–∏—Ç —Ç–µ–∫—É—â—É—é –ª–æ–∫–∞—Ü–∏—é –∏–≥—Ä–æ–∫–∞ –∏ –¥–æ–±–∞–≤–ª—è–µ—Ç –µ—ë –æ–ø–∏—Å–∞–Ω–∏–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç –Ω–∞—Ä—Ä–∞—Ç–∏–≤–∞.

### 5. –ù–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥–µ–π—Å—Ç–≤–∏–π –≤ –Ω–∞—Ä—Ä–∞—Ç–∏–≤–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ

- **–ü—Ä–æ–±–ª–µ–º–∞**: –ù–∞—Ä—Ä–∞—Ç–∏–≤ –ø–æ–ª—É—á–∞–ª —Ç–æ–ª—å–∫–æ –∏—Å—Ç–æ—Ä–∏—é –¥–∏–∞–ª–æ–≥–∞, –Ω–æ –Ω–µ –∑–Ω–∞–ª –æ –º–µ—Ö–∞–Ω–∏—á–µ—Å–∫–∏—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –¥–µ–π—Å—Ç–≤–∏–π (—É—Ä–æ–Ω, –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è).
- **–†–µ—à–µ–Ω–∏–µ**: –í –∏—Å—Ç–æ—Ä–∏—é —Ö–æ–¥–æ–≤ (`historySection`) –¥–æ–±–∞–≤–ª–µ–Ω—ã `toolLogs`, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤.

---

## –ù–∏–∑–∫–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç üü¢

### 7. –ù–µ—Ç retry –ª–æ–≥–∏–∫–∏

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ API –≤–µ—Ä–Ω—ë—Ç –æ—à–∏–±–∫—É (429 Too Many Requests, 503 Service Unavailable), –Ω–µ—Ç –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å retry —Å exponential backoff:

```typescript
const withRetry = async <T>(
  fn: () => Promise<T>, 
  maxRetries = 3, 
  baseDelay = 1000
): Promise<T> => {
  for (let i = 0; i < maxRetries; i++) {
    try {
      return await fn();
    } catch (e: any) {
      if (i === maxRetries - 1) throw e;
      if (e.status === 429 || e.status === 503) {
        await sleep(baseDelay * Math.pow(2, i));
      } else {
        throw e;
      }
    }
  }
  throw new Error('Max retries exceeded');
};
```

**–§–∞–π–ª**: `services/geminiService.ts` –∏–ª–∏ –Ω–æ–≤—ã–π `utils/retry.ts`

---

### 8. –ù–µ—Ç —Ç–∞–π–º–∞—É—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞**: –ï—Å–ª–∏ API –∑–∞–≤–∏—Å, –∑–∞–ø—Ä–æ—Å –±—É–¥–µ—Ç –≤–∏—Å–µ—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –î–æ–±–∞–≤–∏—Ç—å AbortController —Å —Ç–∞–π–º–∞—É—Ç–æ–º:

```typescript
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 30000);

try {
  const response = await ai.models.generateContent({
    // ... –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
    signal: controller.signal
  });
} finally {
  clearTimeout(timeoutId);
}
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–∏ Google GenAI SDK —Å–∏–≥–Ω–∞–ª—ã abort.

**–§–∞–π–ª**: `services/geminiService.ts`

---

### 9. –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞**: `createSystemInstruction` –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –≤ —Ä–∞–º–∫–∞—Ö –æ–¥–Ω–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è**: –ú–µ–º–æ–∏–∑–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –∫—ç—à–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

```typescript
const instructionCache = new Map<string, string>();

const createSystemInstruction = (state: GameState, isFinalNarrative: boolean) => {
  const cacheKey = `${JSON.stringify(state)}-${isFinalNarrative}`;
  if (instructionCache.has(cacheKey)) {
    return instructionCache.get(cacheKey)!;
  }
  // ... —Å–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
  instructionCache.set(cacheKey, result);
  return result;
};
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ**: –ö—ç—à –¥–æ–ª–∂–µ–Ω –æ—á–∏—â–∞—Ç—å—Å—è –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏.

**–§–∞–π–ª**: `services/geminiService.ts`

---

–î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é —Ç–∏–ø–∏–∑–∞—Ü–∏—é –¥–ª—è –æ—Ç–≤–µ—Ç–æ–≤ Gemini API –≤–º–µ—Å—Ç–æ `any`.

---

## –ö–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è

1. –î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
2. –£–∫–∞–∂–∏—Ç–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º–æ–µ —Ä–µ—à–µ–Ω–∏–µ —Å –ø—Ä–∏–º–µ—Ä–æ–º –∫–æ–¥–∞
3. –£–∫–∞–∂–∏—Ç–µ —Ñ–∞–π–ª—ã, –∫–æ—Ç–æ—Ä—ã–µ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å
4. –ü—Ä–∏—Å–≤–æ–π—Ç–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç (üî¥ –≤—ã—Å–æ–∫–∏–π, üü° —Å—Ä–µ–¥–Ω–∏–π, üü¢ –Ω–∏–∑–∫–∏–π)
5. –ü–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –≤ —Å–µ–∫—Ü–∏—é "–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ ‚úÖ"
