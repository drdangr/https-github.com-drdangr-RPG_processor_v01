# Система Инструментов (Tools)

Приложение использует модульную систему инструментов. Каждый инструмент — это отдельный файл, который содержит определение для ИИ (Schema) и логику выполнения (Implementation).

## Структура Инструмента
Каждый файл в папке `src/tools/` должен экспортировать объект типа `GameTool` по умолчанию (`export default`).

```typescript
// src/types.ts
export interface GameTool {
  // Определение для Gemini API
  definition: {
    name: string;        // Уникальное имя функции (напр. "heal_player")
    description: string; // Описание для ИИ, когда использовать
    parameters: {        // JSON Schema аргументов
      type: FunctionDeclarationSchemaType.OBJECT,
      properties: { ... },
      required: [...]
    }
  };
  
  // Логика выполнения
  apply: (state: GameState, args: any) => { 
    newState: GameState; // Клонированное и измененное состояние
    result: string;      // Текстовый отчет (напр. "Здоровье восстановлено до 100")
  };
}
```

## Создание нового инструмента

1.  Создайте новый файл в папке `src/tools/` (например, `src/tools/breakObject.ts`).
2.  Скопируйте шаблон существующего инструмента.
3.  Опишите `definition` (имя, описание, параметры).
4.  Реализуйте функцию `apply`.
    *   **Важно:** Всегда используйте `cloneState(state)` перед модификацией, чтобы соблюдать иммутабельность.
    *   Верните человекочитаемый `result` на русском языке (этот текст увидит ИИ).

## Регистрация и Автозагрузка (Auto-Loader)

Система регистрации находится в `src/tools/index.ts`.

Она поддерживает **два режима**:

### 1. Автоматический (Webpack `require.context`)
Если среда сборки поддерживает `require.context` (стандарт для Create React App), система автоматически сканирует папку `src/tools/` на наличие файлов `.ts` (исключая `index.ts`).
*   **Как это работает:** Любой новый файл, добавленный в папку, автоматически появится в UI и станет доступен ИИ после перезагрузки страницы/пересборки.
*   **Требование:** Файл должен иметь `export default`.

### 2. Ручной (Fallback)
Если `require.context` недоступен (например, при переходе на Vite или другие сборщики без настройки макросов), используется ручной список.
*   В файле `src/tools/index.ts` нужно вручную импортировать файл и добавить его в массив `tools`.

```typescript
// src/tools/index.ts (Manual section)
import myNewTool from './myNewTool';

let tools = [
  ...,
  myNewTool
];
```
